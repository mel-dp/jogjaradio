<!DOCTYPE html> 
<html> 
<head> 
  <title>Dirty P Radio App</title> 
  <meta name="viewport" content="initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="stylesheet" href="css/jquery.mobile-1.2.0.css" />
  <link rel="stylesheet" href="css/leaflet.css" />
  <script src="js/jquery-1.8.2.min.js"></script>
  <script src="js/jquery.mobile-1.2.0.min.js"></script>
  <script type="text/javascript" src="cordova-2.6.0.js"></script>
  <script type="text/javascript" src="js/leaflet.js"></script>
  <script type="text/javascript">
  //Wait for Cordova to load
  //
  document.addEventListener("deviceready", onDeviceReady, false);

  // Cordova is ready
  //
  function onDeviceReady() {
	    console.log('ready');
  };
  
  var myMedia = null;
  var mediaTimer = null;
  var mediaState = 0;
  	// Auto Start
		window.onload = function() { playStream(); };
		// Code from http://www.joeldare.com/wiki/play_an_mp3_audio_stream_in_phonegap
		function playStream() {
		  try {
		    var myMedia = new Audio('http://air.dirtypradio.com:8000/192');
		  //  myMedia.id = 'playerMyAudio';
		    myMedia.play();
		  } catch (e) {
		    alert('no audio support!');
		  }
		}
  

  function updateMedia(radioUrl) {
  	if(myMedia != null) {
  		myMedia.release();
  	}
//     	document.getElementById('audio_title').innerHTML = radioUrl;
  	myMedia = new Audio(radioUrl,
  				function() { // success callback
  					console.log("Media instance success.");
  				},
  				function() { // error callback
  					console.log("Media error");
  				},
  				function(status) {
  					///console.log("status: "+status);
  					mediaState = status;
  					if(status == Media.MEDIA_NONE) {
  						console.log("MEDIA_NONE");
  					} else if(status == Media.MEDIA_STARTING) {
  						console.log("MEDIA_STARTING");
  						$.mobile.loading( 'show', {
  							text: 'buffering..',
  							textVisible: true,
  							theme: 'a',
  							textonly: false,
  							html: ''
  					});
//  				       	document.getElementById('audio_position').innerHTML = 'buffering';
  						$('#play .ui-btn-text').text("P A U S E");
  					} else if(status == Media.MEDIA_RUNNING) {
  						console.log("MEDIA_RUNNING");
  						$.mobile.loading( 'hide' );
  						$('#play .ui-btn-text').text("P A U S E");
  					} else if(status == Media.MEDIA_PAUSED) {
  						console.log("MEDIA_PAUSED");
  						$('#play .ui-btn-text').text("STREAM");
  					} else if(status == Media.MEDIA_STOPPED) {
  						console.log("MEDIA_STOPPED");
//  				       	document.getElementById('audio_position').innerHTML = '<3';
  						$('#play .ui-btn-text').text("STREAM");
  					} else {
  						console.log("MEDIA_UNKNOWN");
  					}
  				});
  };
  function playAudio() {
  	if(mediaState != Media.MEDIA_STARTING && mediaState != Media.MEDIA_RUNNING) {
  		myMedia.play();
  		// Update myMedia position every second
          if (mediaTimer == null) {
              mediaTimer = setInterval(function() {
                  // get myMedia position
                  myMedia.getCurrentPosition(
                      // success callback
                      function(position) {
                          if (mediaState == 2 && position > -1) {
//                          	document.getElementById('audio_position').innerHTML = position + '/' + myMedia.getDuration() + ' secs.';
                          }
                      },
                      // error callback
                      function(e) {
                          console.log("Error getting pos=" + e);
//                      	document.getElementById('audio_position').innerHTML = "Error: " + e;
                      }
                  );
              }, 1000);
          }
  	} else {
  		myMedia.pause();
  	}
  };
  function stopAudio() {
  	myMedia.stop();
  	myMedia = new Audio ('');
  	clearInterval(mediaTimer);
  	mediaTimer = null;
  };
  function startAudio(streamingUrl) {
		updateMedia(streamingUrl);
		playAudio();
  };
	function showRadioMap() {
		
		var map = L.map('map').setView([40.7099168,-74.0186481], 13);
		// add an OpenStreetMap tile layer
		//L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		//	maxZoom: 18
		//	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		//}).addTo(map);
		L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg',
		{
			attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
			subdomains: '1234',
			maxZoom: 18
		}).addTo(map);
		var dirtyp192 = L.marker([40.7099168,-74.0186481]).addTo(map);
		dirtyp192.bindPopup("<b>Dirty P Radio</b><br/>192kbs").openPopup();
		var dirtyp = L.marker([40.7099168,-74.0186481]).addTo(map);
		dirtyp.bindPopup("<b>Dirty P Radio</b><br/>128kbs");
	};
  </script>
</head> 
<body> 

<div data-role="page" id="main">

	<div data-role="header" data-position="fixed">
		<h1>Dirty P Radio</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<h2>Dirty P Radio App</h2>
		<p>Notice that the theme is different for this page because we've added a few <code>data-theme</code> swatch assigments here to show off how flexible it is.</p>	
		<ul data-role="listview" data-inset="true" data-filter="true">
			<li data-role="list-divider">Select Stream Quality</li>
			<li><a href="#dirtyp192">Dirty P Radio - 192 Stream</a></li>
			<li><a href="#dirtyp">Dirty P Radio - 128 Stream</a></li>
		</ul>
		
		<div data-role="collapsible" data-theme="a" data-content-theme="d">
			<h3>I'm a themed collapsible with a themed content</h3>
			<p>I have <code> data-content-theme</code> attribute set manually on my container to set the color to match the content block I'm in. </p>
		</div>
	</div><!-- /content -->
	
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#main" data-icon="grid" data-transition="flip" data-prefetch class="ui-btn-active ui-state-persist">Streaming</a></li>
				<li><a href="#maps" data-icon="home" data-transition="flip" data-prefetch>Maps</a></li>
			</ul>
		</div>
	</div><!-- /footer -->
</div><!-- /page main -->

<div data-role="page" id="maps">

	<div data-role="header" data-position="fixed">
		<h1>Dirty P Radio</h1>
	</div><!-- /header -->

	<div data-role="content"> 
		<div class="ui-body">
			<h1>Radio Map</h1>
			<p>This is a paragraph that contains <strong>strong</strong>, <em>emphasized</em> and <a href="index.html">linked</a> text.</p>
			<a href="#" data-role="button" onclick="showRadioMap();">show map</a>
			<div id="map" style="width: 320px; height: 320px"></div>
		</div><!-- /themed container -->
	</div><!-- /content -->

	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#main" data-icon="grid" data-transition="flip" data-prefetch data-direction="reverse">Radio</a></li>
				<li><a href="#maps" data-icon="home" data-transition="flip" data-prefetch class="ui-btn-active ui-state-persist">About</a></li>
			</ul>
		</div>
	</div>

</div><!-- /page maps -->

<div data-role="page" id="dirtyp192">

	<div data-role="header" data-position="fixed">
		<a href="#main" data-role="button">Back</a>
		<h1>Dirty P Radio</h1>
	</div><!-- /header -->

	<div data-role="content">
		<h1>Dirty P Radio 192</h1>
		<p>Don't Be Ordinary Be Dirty</p>	
		
		<a href="#" data-role="button" onclick="startAudio('http://162.221.184.92:8000/192.m3u');">streaming</a>
		<a href="#" data-role="button" onclick="playStream();">Play</a>
		<a href="#" data-role="button" onclick="stopAudio();">Stop</a>
		<div data-role="collapsible" data-theme="a" data-content-theme="d">
			<h3>I'm a themed collapsible with a themed content</h3>
			<p>I have <code> data-content-theme</code> attribute set manually on my container to set the color to match the content block I'm in. </p>
		</div>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#main" data-icon="grid" data-transition="flip" data-prefetch class="ui-btn-active ui-state-persist">Radio</a></li>
				<li><a href="#maps" data-icon="home" data-transition="flip" data-prefetch>About</a></li>
			</ul>
		</div>
	</div><!-- /footer -->
</div><!-- /page dirtyp192 -->
<div data-role="page" id="dirtyp">

	<div data-role="header" data-position="fixed">
		<a href="#main" data-role="button">Back</a>
		<h1>Dirty P Radio 128</h1>
	</div><!-- /header -->

	<div data-role="content">
		<h1>Dirty P Radio 128</h1>
		<p>I have an id of "two" on my page container. I'm the second page container in this multi-page template.</p>	
		
		<a href="#" data-role="button" onclick="startAudio('http://162.221.184.92:8000/128');">streaming</a>
		<a href="#" data-role="button" onclick="stopAudio();">stop</a>
		<div data-role="collapsible" data-theme="a" data-content-theme="d">
			<h3>I'm a themed collapsible with a themed content</h3>
			<p>I have <code> data-content-theme</code> attribute set manually on my container to set the color to match the content block I'm in. </p>
		</div>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				<li><a href="#main" data-icon="grid" data-transition="flip" data-prefetch class="ui-btn-active ui-state-persist">Streaming</a></li>
				<li><a href="#maps" data-icon="home" data-transition="flip" data-prefetch>Maps</a></li>
			</ul>
		</div>
	</div><!-- /footer -->
</div><!-- /page dirtyp -->


</body>
</html>
